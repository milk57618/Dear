package com.example.eunsol.dear.main.Activity;

import android.app.Activity;

import android.graphics.Color;


import android.os.Bundle;

import android.util.Log;

import android.view.WindowManager;
import android.widget.TextView;

import com.example.eunsol.dear.R;

import com.example.eunsol.dear.main.DB_Pos.saleRank;

import com.github.mikephil.charting.animation.Easing;

import com.github.mikephil.charting.charts.PieChart;

import com.github.mikephil.charting.components.Legend;

import com.github.mikephil.charting.data.Entry;

import com.github.mikephil.charting.data.PieData;

import com.github.mikephil.charting.data.PieDataSet;

import com.github.mikephil.charting.data.PieEntry;

import com.github.mikephil.charting.formatter.PercentFormatter;

import com.github.mikephil.charting.highlight.Highlight;

import com.github.mikephil.charting.listener.OnChartValueSelectedListener;

import com.github.mikephil.charting.utils.ColorTemplate;

import com.github.mikephil.charting.utils.MPPointF;

import java.util.ArrayList;



/**

 Copyright {2017} {PhilJay}



 Licensed under the Apache License, Version 2.0 (the "License");

 you may not use this file except in compliance with the License.

 You may obtain a copy of the License at



 http://www.apache.org/licenses/LICENSE-2.0



 Unless required by applicable law or agreed to in writing, software

 distributed under the License is distributed on an "AS IS" BASIS,

 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.

 See the License for the specific language governing permissions and

 limitations under the License.

 */



public class AnalysisActivity extends Activity implements OnChartValueSelectedListener {



    private PieChart mChart;

    private ArrayList<saleRank> rank;

    private TextView txPrice;

    private TextView txCard;

    private TextView txCash;





    @Override

    protected void onCreate(Bundle savedInstanceState) {

        super.onCreate(savedInstanceState);

        getWindow().setFlags(WindowManager.LayoutParams.FLAG_FULLSCREEN,

                WindowManager.LayoutParams.FLAG_FULLSCREEN);

        setContentView(R.layout.activity_analysis);

        txPrice=findViewById(R.id.txPrice);
        txCard = findViewById(R.id.txCard);
        txCash = findViewById(R.id.txCash);



        rank = SaleActivity.rank;

        //파이차트를 얻는다

        mChart = (PieChart) findViewById(R.id.chart1);

        //차트 환경설정

        mChart.setUsePercentValues(true);

        mChart.getDescription().setEnabled(false);

        mChart.setExtraOffsets(5, 10, 5, 5);

        mChart.setDragDecelerationFrictionCoef(0.95f);

        mChart.setDrawHoleEnabled(true);


        mChart.setDrawHoleEnabled(false);


        mChart.setTransparentCircleColor(Color.WHITE);

        mChart.setTransparentCircleAlpha(110);

        mChart.setHoleRadius(58f);

        mChart.setTransparentCircleRadius(61f);

        mChart.setDrawCenterText(true);

        mChart.setRotationAngle(0);

        mChart.setRotationEnabled(true);

        mChart.setHighlightPerTapEnabled(true);


        // 차트의 값을 클릭이벤트 리스너 생성

        mChart.setOnChartValueSelectedListener(this);



        setData(4);



        mChart.animateY(1400, Easing.EasingOption.EaseInOutQuad);



        Legend l = mChart.getLegend();

        l.setVerticalAlignment(Legend.LegendVerticalAlignment.TOP);

        l.setHorizontalAlignment(Legend.LegendHorizontalAlignment.RIGHT);

        l.setOrientation(Legend.LegendOrientation.VERTICAL);

        l.setDrawInside(false);

        l.setXEntrySpace(7f);

        l.setYEntrySpace(0f);

        l.setYOffset(0f);



        //label 속성설정

        mChart.setEntryLabelColor(Color.WHITE);

        mChart.setEntryLabelTextSize(20f);

    }





    private void setData(int count) {



        ArrayList<PieEntry> entries = new ArrayList<PieEntry>();



        // NOTE: The order of the entries when being added to the entries array determines their position around the center of

        // the chart.

        for (int i = 0; i < count ; i++) {



            if(rank.get(i).getPrice()>10000 ) {

                String name = rank.get(i).getMonth().substring(3, 5)+"월";

                entries.add(new PieEntry(rank.get(i).getPrice(),name));

            }

        }



        PieDataSet dataSet = new PieDataSet(entries, "매출 조회");



        dataSet.setDrawIcons(false);

        dataSet.setFormSize(10);

        dataSet.setIconsOffset(new MPPointF(0, 40));

        dataSet.setSelectionShift(10f);



        // add a lot of colors



        ArrayList<Integer> colors = new ArrayList<Integer>();



        for (int c : ColorTemplate.VORDIPLOM_COLORS)

            colors.add(c);



        for (int c : ColorTemplate.JOYFUL_COLORS)

            colors.add(c);



        for (int c : ColorTemplate.PASTEL_COLORS)

            colors.add(c);



        for (int c : ColorTemplate.LIBERTY_COLORS)

            colors.add(c);



        for (int c : ColorTemplate.PASTEL_COLORS)

            colors.add(c);



        colors.add(ColorTemplate.getHoloBlue());



        dataSet.setColors(colors);

        //dataSet.setSelectionShift(0f);



        PieData data = new PieData(dataSet);

        data.setValueFormatter(new PercentFormatter());

        data.setValueTextSize(20f);

        data.setValueTextColor(Color.WHITE);

        mChart.setData(data);



        // undo all highlights

        mChart.highlightValues(null);



        mChart.invalidate();

    }





    @Override

    public void onValueSelected(Entry e, Highlight h) {

        if (e == null)
            return;

        txCard.setText(Integer.toString(rank.get((int)h.getX()).getCard())+" 원");
        txCash.setText(Integer.toString(rank.get((int)h.getX()).getCash())+" 원");
        txPrice.setText(Integer.toString(rank.get((int)h.getX()).getPrice())+" 원");
    }



    @Override

    public void onNothingSelected() {

        Log.i("PieChart", "nothing selected");

    }



}